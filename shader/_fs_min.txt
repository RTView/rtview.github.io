precision highp float;precision highp int;uniform vec3 v;\n#extension GL_OES_standard_derivatives:enable\nuniform samplerCube w;uniform sampler2D x;uniform vec3 n,y,z;uniform float A,o,p,B,C,D;varying vec3 E,F;float k(float a){return clamp(a,0.,1.);}vec3 G(vec3 d,float e,float j,float b,float f){float a=(.5+2.*b*b)*f;a-=1.;float g=1.-e,c=pow(g,5.),h=1.+a*c,i=1.+a*c;return d*h*i/3.141593;}float H(float b,float c){float d=b*b,e=c*c,a=e*(d-1.)+1.;a=pow(a,2.)*3.141593;return d/a;}float q(float a,float b){float c=b*b;c+=a*a*(1.-b*b),c=a+sqrt(c);return 2.*a/c;}float I(float a,float b,float c,float d,float e,float f){return q(c,a)*q(b,a);}vec3 J(vec3 a,float b){return a+(1.-a)*pow(1.-b,5.);}float K(float a){return pow(1.-(1.-a)*.7,6.);}varying vec2 m;vec3 L(vec3 a,vec3 f){vec3 b=dFdx(a.xyz),c=dFdy(a.xyz);vec2 d=dFdx(m.st),e=dFdy(m.st);vec3 g=normalize(b*e.t-c*d.t),h=normalize(-b*e.s+c*d.s),i=f,j=texture2D(x,m).xyz*2.-1.;mat3 l=mat3(g,h,i);return normalize(l*j);}void main(){vec3 a=normalize(F),b=normalize(v-E),g=normalize(-z),l=normalize(g+b);a=L(b,normalize(a));float c=k(dot(a,g)),d=k(dot(a,b)),r=k(dot(a,l)),h=k(dot(b,l)),M=k(dot(g,b)),e=K(p);vec3 s=n*(1.-o),f=mix(vec3(A),n,o),N=G(s,c,d,h,p),t=H(e,r)*I(e,d,c,r,h,M)*J(f,h)/(4.*c*d+1e-4),u=reflect(-b,a);u.x*=-1.;vec3 i=textureCube(w,u,e*15.).rgb;i=pow(i,vec3(2.2));vec3 O=f+(max(f,1.-e)-f)*pow(1.-d,10.),j=(N*(1.-t)+t)*y*c*C;j+=s*D,j+=i*O*B,gl_FragColor=pow(vec4(j,1.),vec4(.454545));